<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Planilha de Produtos</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: white;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #007BFF;
      color: white;
    }
    tr:nth-child(even) {
      background-color: #f2f2f2;
    }
    img {
      max-width: 100px;
    }
    .total-sum {
      margin-top: 20px;
      font-size: 1.2em;
      font-weight: bold;
    }
    button {
      margin: 10px 5px;
      padding: 10px 20px;
      font-size: 14px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Planilha de Produtos</h1>
  <div>
    <button onclick="salvarComoHTML()">Salvar Versão Atualizada</button>
  </div>
  <table id="planilha">
    <thead>
      <tr>
        <th>ID</th>
        <th>Nome</th>
        <th>Imagem</th>
        <th>Loja</th>
        <th>Link</th>
        <th>Preço (R$)</th>
        <th>Qtd</th>
        <th>Total</th>
      </tr>
    </thead>
    <tbody>
      <!-- Dados serão inseridos via script -->
    </tbody>
  </table>
  <div class="total-sum" id="somaTotal">Soma total: R$ 0,00</div>

  <script>
    function atualizarSomaTotal() {
      let soma = 0;
      document.querySelectorAll("#planilha tbody tr").forEach(row => {
        const total = parseFloat(row.querySelector(".total").textContent.replace(',', '.'));
        if (!isNaN(total)) soma += total;
      });
      document.getElementById("somaTotal").textContent = `Soma total: R$ ${soma.toFixed(2).replace('.', ',')}`;
    }

    function salvarComoHTML() {
      const htmlAtual = document.documentElement.outerHTML;
      const blob = new Blob([htmlAtual], { type: "text/html" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "planilha-atualizada.html";
      a.click();
    }

    function adicionarProduto({ id, nome, imagem, loja, link, preco, quantidade }) {
      const tbody = document.querySelector("#planilha tbody");
      const tr = document.createElement("tr");

      const total = (parseFloat(preco) * parseInt(quantidade)).toFixed(2);

      tr.innerHTML = `
        <td>${id}</td>
        <td>${nome}</td>
        <td><img src="${imagem}" alt="Imagem"/></td>
        <td>${loja}</td>
        <td><a href="${link}" target="_blank">Ver Produto</a></td>
        <td>${parseFloat(preco).toFixed(2)}</td>
        <td>${quantidade}</td>
        <td class="total">${total}</td>
      `;

      tbody.appendChild(tr);
      atualizarSomaTotal();
    }

    // Permite acesso externo pelo script do Tampermonkey
    window.adicionarProduto = adicionarProduto;
  </script>
</body>
</html>

