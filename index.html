<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Planilha de Produtos com ID e Varia√ß√µes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#4f46e5',
              secondary: '#ec4899'
            }
          }
        }
      }
    </script>
  </head>
  <body class="bg-gray-100 font-sans">
    <div class="max-w-7xl mx-auto py-8 px-4">
      <header class="mb-6">
        <h1 class="text-3xl font-bold text-primary mb-2">üì¶ Planilha de Produtos com ID e Varia√ß√µes</h1>
        <div class="flex gap-4 flex-wrap text-sm text-gray-700">
          <div id="totalProdutos">Total: 0 produtos</div>
          <div id="totalValor">Valor total: R$ 0,00</div>
          <div id="totalLojas">Lojas: 0</div>
          <div id="ultimaAtualizacao">Atualizado: --</div>
        </div>
      </header>

      <!-- Formul√°rio para adicionar produto normal -->
      <section class="mb-8 p-4 bg-white rounded-lg shadow-md">
        <h2 class="text-xl font-semibold mb-3">Adicionar Produto Manualmente</h2>
        <form id="formProduto" class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
          <div>
            <label class="block mb-1 font-medium" for="nome">Nome do Produto</label>
            <input type="text" id="nome" class="w-full p-2 border rounded" required />
          </div>
          <div>
            <label class="block mb-1 font-medium" for="preco">Pre√ßo (R$)</label>
            <input type="number" id="preco" class="w-full p-2 border rounded" step="0.01" min="0" required />
          </div>
          <div>
            <label class="block mb-1 font-medium" for="loja">Loja</label>
            <input type="text" id="loja" class="w-full p-2 border rounded" required />
          </div>
          <div>
            <label class="block mb-1 font-medium" for="url">URL do Produto</label>
            <input type="url" id="url" class="w-full p-2 border rounded" required />
          </div>
          <div>
            <label class="block mb-1 font-medium" for="imagem">URL da Imagem</label>
            <input type="url" id="imagem" class="w-full p-2 border rounded" required />
          </div>
          <div>
            <label class="block mb-1 font-medium" for="quantidade">Quantidade</label>
            <input type="number" id="quantidade" class="w-full p-2 border rounded" value="1" min="1" required />
          </div>
          <div class="md:col-span-3">
            <button type="submit" class="w-full bg-primary text-white py-2 rounded hover:bg-indigo-700 transition">
              Adicionar Produto
            </button>
          </div>
        </form>
      </section>

      <!-- Formul√°rio para adicionar varia√ß√£o -->
      <section class="mb-8 p-4 bg-white rounded-lg shadow-md">
        <h2 class="text-xl font-semibold mb-3">Adicionar Varia√ß√£o de Produto</h2>
        <form id="formVariacao" class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
          <div>
            <label class="block mb-1 font-medium" for="idProdutoVariacao">ID do Produto</label>
            <input type="number" id="idProdutoVariacao" class="w-full p-2 border rounded" min="1" required />
          </div>
          <div>
            <label class="block mb-1 font-medium" for="precoVariacao">Pre√ßo (R$)</label>
            <input type="number" id="precoVariacao" class="w-full p-2 border rounded" step="0.01" min="0" required />
          </div>
          <div>
            <label class="block mb-1 font-medium" for="urlVariacao">URL da Varia√ß√£o</label>
            <input type="url" id="urlVariacao" class="w-full p-2 border rounded" required />
          </div>
          <div>
            <label class="block mb-1 font-medium" for="quantidadeVariacao">Quantidade</label>
            <input type="number" id="quantidadeVariacao" class="w-full p-2 border rounded" value="1" min="1" required />
          </div>
          <div class="md:col-span-4">
            <button type="submit" class="w-full bg-secondary text-white py-2 rounded hover:bg-pink-600 transition">
              Adicionar Varia√ß√£o
            </button>
          </div>
        </form>
      </section>

      <!-- Barra de filtros -->
      <div class="mb-4 flex flex-wrap gap-4 items-center">
        <input
          type="text"
          id="filtroBusca"
          placeholder="Buscar por nome, loja ou ID..."
          class="p-2 border rounded w-full md:w-64"
        />
        <select id="filtroLoja" class="p-2 border rounded">
          <option value="">Todas as lojas</option>
        </select>
        <button onclick="exportarTabela()" class="bg-secondary text-white px-4 py-2 rounded hover:bg-pink-600 transition">
          Exportar
        </button>
      </div>

      <!-- Tabela -->
      <div class="overflow-x-auto">
        <table class="min-w-full bg-white rounded-lg shadow-md">
          <thead>
            <tr class="bg-gray-200 text-left text-sm uppercase">
              <th class="p-3">ID</th>
              <th class="p-3">Imagem</th>
              <th class="p-3">Produto</th>
              <th class="p-3">Loja</th>
              <th class="p-3">Pre√ßo</th>
              <th class="p-3">Qtd</th>
              <th class="p-3">Total</th>
              <th class="p-3">A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="tabelaProdutos"></tbody>
        </table>
      </div>
    </div>

    <!-- Modal Editar Produto -->
    <div
      id="modalEditar"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden"
    >
      <div class="bg-white rounded-lg shadow-lg p-6 max-w-md w-full">
        <h3 class="text-xl font-semibold mb-4">Editar Produto</h3>
        <form id="formEditarProduto" class="grid grid-cols-1 gap-4">
          <input type="hidden" id="editarId" />
          <div>
            <label for="editarNome" class="block mb-1 font-medium">Nome do Produto</label>
            <input type="text" id="editarNome" class="w-full p-2 border rounded" required />
          </div>
          <div>
            <label for="editarPreco" class="block mb-1 font-medium">Pre√ßo (R$)</label>
            <input type="number" id="editarPreco" class="w-full p-2 border rounded" step="0.01" min="0" required />
          </div>
          <div>
            <label for="editarLoja" class="block mb-1 font-medium">Loja</label>
            <input type="text" id="editarLoja" class="w-full p-2 border rounded" required />
          </div>
          <div>
            <label for="editarUrl" class="block mb-1 font-medium">URL do Produto</label>
            <input type="url" id="editarUrl" class="w-full p-2 border rounded" required />
          </div>
          <div>
            <label for="editarImagem" class="block mb-1 font-medium">URL da Imagem</label>
            <input type="url" id="editarImagem" class="w-full p-2 border rounded" required />
          </div>
          <div>
            <label for="editarQuantidade" class="block mb-1 font-medium">Quantidade</label>
            <input type="number" id="editarQuantidade" class="w-full p-2 border rounded" min="1" required />
          </div>
          <div class="flex justify-end gap-4 mt-4">
            <button
              type="button"
              onclick="fecharModal()"
              class="px-4 py-2 rounded border border-gray-300 hover:bg-gray-100"
            >
              Cancelar
            </button>
            <button type="submit" class="bg-primary text-white px-4 py-2 rounded hover:bg-indigo-700 transition">
              Salvar Altera√ß√µes
            </button>
          </div>
        </form>
      </div>
    </div>

    <script>
      let produtos = [];
      let proximoId = 1; // controle do pr√≥ximo ID incremental

      // Fun√ß√£o para formatar valores em reais
      function formatarReais(valor) {
        return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
      }

      // Fun√ß√£o para renderizar a tabela de produtos
      function renderizarTabela() {
        const corpo = document.getElementById('tabelaProdutos');
        corpo.innerHTML = '';

        const lojas = new Set();
        let totalValor = 0;

        produtos.forEach((produto, index) => {
          lojas.add(produto.loja);
          const subtotal = produto.preco * produto.quantidade;
          totalValor += subtotal;

          const tr = document.createElement('tr');
          tr.className = 'border-t';

          tr.innerHTML = `
            <td class="p-3 font-mono">${produto.id}</td>
            <td class="p-3">
              <img src="${produto.imagem}" alt="imagem" class="w-16 h-16 object-cover rounded" />
            </td>
            <td class="p-3 text-sm">
              <a href="${produto.url}" target="_blank" class="text-blue-600 hover:underline">${produto.nome}</a>
            </td>
            <td class="p-3 text-sm">${produto.loja}</td>
            <td class="p-3 text-sm">${formatarReais(produto.preco)}</td>
            <td class="p-3 text-sm">${produto.quantidade}</td>
            <td class="p-3 text-sm">${formatarReais(subtotal)}</td>
            <td class="p-3 text-sm space-x-2">
              <button
                onclick="abrirModalEditar(${produto.id})"
                class="text-blue-600 hover:text-blue-800"
                title="Editar"
              >
                <i data-lucide="edit-2"></i>
              </button>
              <button
                onclick="removerProduto(${produto.id})"
                class="text-red-600 hover:text-red-800"
                title="Remover"
              >
                <i data-lucide="trash-2"></i>
              </button>
            </td>
          `;

          corpo.appendChild(tr);
        });

        document.getElementById('totalProdutos').textContent = `Total: ${produtos.length} produtos`;
        document.getElementById('totalValor').textContent = `Valor total: ${formatarReais(totalValor)}`;
        document.getElementById('totalLojas').textContent = `Lojas: ${lojas.size}`;
        document.getElementById('ultimaAtualizacao').textContent = `Atualizado: ${new Date().toLocaleString()}`;

        // Atualizar filtro lojas
        const filtroLoja = document.getElementById('filtroLoja');
        const opcoes = Array.from(lojas)
          .sort((a, b) => a.localeCompare(b))
          .map((loja) => `<option value="${loja}">${loja}</option>`);
        filtroLoja.innerHTML = '<option value="">Todas as lojas</option>' + opcoes.join('');

        lucide.createIcons();
      }

      // Adicionar produto normal
      document.getElementById('formProduto').addEventListener('submit', (e) => {
        e.preventDefault();
        const nome = document.getElementById('nome').value.trim();
        const preco = parseFloat(document.getElementById('preco').value);
        const loja = document.getElementById('loja').value.trim();
        const url = document.getElementById('url').value.trim();
        const imagem = document.getElementById('imagem').value.trim();
        const quantidade = parseInt(document.getElementById('quantidade').value);

        if (!nome || preco < 0 || !loja || !url || !imagem || quantidade < 1) {
          alert('Preencha todos os campos corretamente.');
          return;
        }

        produtos.push({ id: proximoId++, nome, preco, loja, url, imagem, quantidade });
        renderizarTabela();
        e.target.reset();
      });

      // Adicionar varia√ß√£o de produto
      document.getElementById('formVariacao').addEventListener('submit', (e) => {
        e.preventDefault();
        const idOriginal = parseInt(document.getElementById('idProdutoVariacao').value);
        const preco = parseFloat(document.getElementById('precoVariacao').value);
        const url = document.getElementById('urlVariacao').value.trim();
        const quantidade = parseInt(document.getElementById('quantidadeVariacao').value);

        if (isNaN(idOriginal) || preco < 0 || !url || quantidade < 1) {
          alert('Preencha todos os campos corretamente.');
          return;
        }

        const produtoOriginal = produtos.find((p) => p.id === idOriginal);
        if (!produtoOriginal) {
          alert(`Produto com ID ${idOriginal} n√£o encontrado.`);
          return;
        }

        // Cria a varia√ß√£o copiando nome, loja e imagem do original
        produtos.push({
          id: proximoId++,
          nome: produtoOriginal.nome,
          preco,
          loja: produtoOriginal.loja,
          url,
          imagem: produtoOriginal.imagem,
          quantidade
        });

        renderizarTabela();
        e.target.reset();
      });

      // Remover produto pelo id
      function removerProduto(id) {
        produtos = produtos.filter((p) => p.id !== id);
        renderizarTabela();
      }

      // Abrir modal para editar produto
      function abrirModalEditar(id) {
        const produto = produtos.find((p) => p.id === id);
        if (!produto) return;

        document.getElementById('editarId').value = produto.id;
        document.getElementById('editarNome').value = produto.nome;
        document.getElementById('editarPreco').value = produto.preco;
        document.getElementById('editarLoja').value = produto.loja;
        document.getElementById('editarUrl').value = produto.url;
        document.getElementById('editarImagem').value = produto.imagem;
        document.getElementById('editarQuantidade').value = produto.quantidade;

        document.getElementById('modalEditar').classList.remove('hidden');
      }

      // Fechar modal editar
      function fecharModal() {
        document.getElementById('modalEditar').classList.add('hidden');
      }

      // Salvar altera√ß√µes do produto editado
      document.getElementById('formEditarProduto').addEventListener('submit', (e) => {
        e.preventDefault();
        const id = parseInt(document.getElementById('editarId').value);
        const nome = document.getElementById('editarNome').value.trim();
        const preco = parseFloat(document.getElementById('editarPreco').value);
        const loja = document.getElementById('editarLoja').value.trim();
        const url = document.getElementById('editarUrl').value.trim();
        const imagem = document.getElementById('editarImagem').value.trim();
        const quantidade = parseInt(document.getElementById('editarQuantidade').value);

        if (!nome || preco < 0 || !loja || !url || !imagem || quantidade < 1) {
          alert('Preencha todos os campos corretamente.');
          return;
        }

        const index = produtos.findIndex((p) => p.id === id);
        if (index === -1) {
          alert('Produto n√£o encontrado.');
          fecharModal();
          return;
        }

        produtos[index] = { id, nome, preco, loja, url, imagem, quantidade };
        renderizarTabela();
        fecharModal();
      });

      // Filtros de busca (nome, loja ou id)
      document.getElementById('filtroBusca').addEventListener('input', (e) => {
        const termo = e.target.value.toLowerCase();

        document.querySelectorAll('#tabelaProdutos tr').forEach((tr) => {
          const texto = tr.textContent.toLowerCase();
          tr.style.display = texto.includes(termo) ? '' : 'none';
        });
      });

      // Filtro por loja
      document.getElementById('filtroLoja').addEventListener('change', (e) => {
        const loja = e.target.value;

        document.querySelectorAll('#tabelaProdutos tr').forEach((tr) => {
          const texto = tr.textContent;
          tr.style.display = loja === '' || texto.includes(loja) ? '' : 'none';
        });
      });

      // Exportar p√°gina atual como arquivo HTML
      function exportarTabela() {
        const html = document.documentElement.outerHTML;
        const blob = new Blob([html], { type: 'text/html' });
        const url = URL.createObjectURL(blob);

        const a = document.createElement('a');
        a.href = url;
        a.download = 'planilha-produtos.html';
        a.click();

        URL.revokeObjectURL(url);
      }

      // Inicializa √≠cones lucide ap√≥s carregar a tabela
      window.addEventListener('load', () => {
        renderizarTabela();
      });
    </script>
  </body>
</html>
