<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Planilha Produtos</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #eee; }
    img { max-width: 60px; }
  </style>
</head>
<body>

<h2>Planilha de Produtos</h2>

<table id="tabela-produtos">
  <thead>
    <tr>
      <th>ID</th><th>Nome</th><th>Loja</th><th>Preço</th><th>Imagem</th><th>Link</th>
    </tr>
  </thead>
  <tbody>
    <!-- Produtos vão aparecer aqui -->
  </tbody>
</table>

<script>
  // Inicializa array produtos com o que estiver salvo no localStorage, ou vazio
  let produtos = JSON.parse(localStorage.getItem('produtos')) || [];

  // Função para adicionar produto no DOM (tabela)
  function adicionaLinhaTabela(produto) {
    const tabela = document.querySelector('#tabela-produtos tbody');
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${produto.id}</td>
      <td>${produto.nome}</td>
      <td>${produto.loja}</td>
      <td>R$ ${produto.preco}</td>
      <td><img src="${produto.imagem}" alt="${produto.nome}" /></td>
      <td><a href="${produto.url}" target="_blank">Link</a></td>
    `;
    tabela.appendChild(tr);
  }

  // Mostra os produtos já salvos ao carregar a página
  produtos.forEach(adicionaLinhaTabela);

  // Escuta mensagens da janela (postMessage)
  window.addEventListener('message', (event) => {
    if (event.origin !== 'https://devixippex.github.io') return;

    const produto = event.data;

    if (!produto || !produto.id) return;

    // Verifica se produto já existe
    const existe = produtos.some(p => p.id === produto.id);
    if (existe) {
      alert('Produto já cadastrado.');
      return;
    }

    // Adiciona ao array e salva localStorage
    produtos.push(produto);
    localStorage.setItem('produtos', JSON.stringify(produtos));

    // Atualiza tabela na tela
    adicionaLinhaTabela(produto);

    alert('Produto adicionado com sucesso!');
  });
</script>

</body>
</html>

