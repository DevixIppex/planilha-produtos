<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Planilha de Produtos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#4f46e5',
              secondary: '#ec4899'
            }
          }
        }
      }
    </script>
  </head>
  <body class="bg-gray-100 font-sans">
    <div class="max-w-6xl mx-auto py-8 px-4">
      <header class="mb-6">
        <h1 class="text-3xl font-bold text-primary mb-2">ðŸ“¦ Planilha de Produtos</h1>
        <div class="flex gap-4 flex-wrap text-sm text-gray-700">
          <div id="totalProdutos">Total: 0 produtos</div>
          <div id="totalValor">Valor total: R$ 0,00</div>
          <div id="totalLojas">Lojas: 0</div>
          <div id="ultimaAtualizacao">Atualizado: --</div>
        </div>
      </header>

      <!-- Entrada estilo chat -->
      <div class="mb-6">
        <h2 class="text-xl font-semibold mb-2">Adicionar Produto Manualmente</h2>
        <form id="chatForm" class="bg-white p-4 rounded-lg shadow-md grid grid-cols-1 md:grid-cols-2 gap-4">
          <input type="text" placeholder="Nome do Produto" id="nome" class="p-2 border rounded" required />
          <input type="text" placeholder="PreÃ§o (R$)" id="preco" class="p-2 border rounded" required />
          <input type="text" placeholder="Loja" id="loja" class="p-2 border rounded" required />
          <input type="url" placeholder="URL do Produto" id="url" class="p-2 border rounded" required />
          <input type="url" placeholder="URL da Imagem" id="imagem" class="p-2 border rounded" required />
          <input type="number" placeholder="Quantidade" id="quantidade" class="p-2 border rounded" value="1" min="1" required />
          <button type="submit" class="md:col-span-2 bg-primary text-white py-2 rounded hover:bg-indigo-700 transition-all">Adicionar Produto</button>
        </form>
      </div>

      <!-- Barra de filtros -->
      <div class="mb-4 flex flex-wrap gap-4 items-center">
        <input type="text" id="filtroBusca" placeholder="Buscar por nome ou loja..." class="p-2 border rounded w-full md:w-64" />
        <select id="filtroLoja" class="p-2 border rounded">
          <option value="">Todas as lojas</option>
        </select>
        <button onclick="exportarTabela()" class="bg-secondary text-white px-4 py-2 rounded hover:bg-pink-600 transition">Exportar</button>
      </div>

      <!-- Tabela -->
      <div class="overflow-x-auto">
        <table class="min-w-full bg-white rounded-lg shadow-md">
          <thead>
            <tr class="bg-gray-200 text-left text-sm uppercase">
              <th class="p-3">Imagem</th>
              <th class="p-3">Produto</th>
              <th class="p-3">Loja</th>
              <th class="p-3">PreÃ§o</th>
              <th class="p-3">Qtd</th>
              <th class="p-3">Total</th>
              <th class="p-3">AÃ§Ãµes</th>
            </tr>
          </thead>
          <tbody id="tabelaProdutos"></tbody>
        </table>
      </div>
    </div>

    <script>
      let produtos = [];

      document.getElementById('chatForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const nome = document.getElementById('nome').value;
        const preco = parseFloat(document.getElementById('preco').value.replace(',', '.'));
        const loja = document.getElementById('loja').value;
        const url = document.getElementById('url').value;
        const imagem = document.getElementById('imagem').value;
        const quantidade = parseInt(document.getElementById('quantidade').value);

        produtos.push({ nome, preco, loja, url, imagem, quantidade });
        renderizarTabela();
        e.target.reset();
      });

      function renderizarTabela() {
        const corpo = document.getElementById('tabelaProdutos');
        corpo.innerHTML = '';

        const lojas = new Set();
        let total = 0;

        produtos.forEach((produto, index) => {
          const linha = document.createElement('tr');
          linha.className = 'border-t';

          const subtotal = produto.preco * produto.quantidade;
          total += subtotal;
          lojas.add(produto.loja);

          linha.innerHTML = `
            <td class="p-3"><img src="${produto.imagem}" alt="imagem" class="w-16 h-16 object-cover rounded" /></td>
            <td class="p-3 text-sm"><a href="${produto.url}" target="_blank" class="text-blue-600 hover:underline">${produto.nome}</a></td>
            <td class="p-3 text-sm">${produto.loja}</td>
            <td class="p-3 text-sm">R$ ${produto.preco.toFixed(2)}</td>
            <td class="p-3 text-sm">${produto.quantidade}</td>
            <td class="p-3 text-sm">R$ ${subtotal.toFixed(2)}</td>
            <td class="p-3 text-sm">
              <button onclick="removerProduto(${index})" class="text-red-500 hover:text-red-700"><i data-lucide="trash"></i></button>
            </td>
          `;

          corpo.appendChild(linha);
        });

        document.getElementById('totalProdutos').textContent = `Total: ${produtos.length} produtos`;
        document.getElementById('totalValor').textContent = `Valor total: R$ ${total.toFixed(2)}`;
        document.getElementById('totalLojas').textContent = `Lojas: ${lojas.size}`;
        document.getElementById('ultimaAtualizacao').textContent = `Atualizado: ${new Date().toLocaleString()}`;

        const filtroLoja = document.getElementById('filtroLoja');
        const opcoes = Array.from(lojas).map(loja => `<option value="${loja}">${loja}</option>`);
        filtroLoja.innerHTML = '<option value="">Todas as lojas</option>' + opcoes.join('');

        lucide.createIcons();
      }

      function removerProduto(index) {
        produtos.splice(index, 1);
        renderizarTabela();
      }

      function exportarTabela() {
        const blob = new Blob([document.documentElement.outerHTML], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'planilha.html';
        a.click();
        URL.revokeObjectURL(url);
      }

      document.getElementById('filtroBusca').addEventListener('input', (e) => {
        const termo = e.target.value.toLowerCase();
        document.querySelectorAll('#tabelaProdutos tr').forEach(tr => {
          const texto = tr.textContent.toLowerCase();
          tr.style.display = texto.includes(termo) ? '' : 'none';
        });
      });

      document.getElementById('filtroLoja').addEventListener('change', (e) => {
        const loja = e.target.value;
        document.querySelectorAll('#tabelaProdutos tr').forEach(tr => {
          const texto = tr.textContent;
          tr.style.display = loja === '' || texto.includes(loja) ? '' : 'none';
        });
      });
    </script>
  </body>
</html>
